<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
        <title>Bootstrap 101 Template</title>

        <!-- Bootstrap -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">  

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
            <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
        <style>
            body {
                padding:10px;    
                padding-top: 65px;
                font-size:12px;
            }
            
            #container {
                margin-bottom:2.5%;
            }
            
            .thumbnail {
                height:600px;
                overflow-y:scroll;
            }
            
            .navbar-text { 
                color:#efefef !important;
            }
            
            .byline {
                color:#ccc;
            }
            
            #end {
                padding-top:20px;
                padding-bottom:20px;
                background-color:#efefef;
                text-align:center;
                font-size:1.1em;
                clear:both;
                display:none;
            }
            
            @media (max-width: 768px) {
                .thumbnail {
                    height:auto;
                    border:1px solid #cc0000;
                }
            }
            
        </style>
    </head>
    <body>
        
        <nav class="navbar navbar-inverse navbar-fixed-top"> <!-- using navbar-inverse turns things black -->
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>                        
                    </button>
                    <a class="navbar-brand" href="#"><img src="http://mw2.wsj.net/mw5/content/logos/mw_logo_onDark.svg" height="24" alt="MarketWatch" /></a>
                </div>
                <div class="collapse navbar-collapse" id="myNavbar">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="#">Home</a></li>
                        <li><a href="#">Page 1</a></li>
                        <li><a href="#">Page 2</a></li>
                        <li><a href="#">Page 3</a></li>
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Page 1
                                <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                              <li><a href="#">Uno</a></li>
                              <li><a href="#">Dos</a></li>
                              <li><a href="#">Tres</a></li>
                            </ul>
                      </li>
                    </ul>
                    <p class="navbar-text">Some text</p>
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="#"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
                        <li class=""><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
                    </ul>
                    
                </div>
              </div>
        </nav>
        
        <div id="container" class=".container-fluid">
            
            <!-- ADDING ROWS AND COLUMNS. Setting up our template. -->
            <div class="tiles">
                

            </div>
            
            <button class="btn btn-default" id="load" start end>Load More</button>
            <div id="end">No more stories. Thanks for reading.</div>
        </div>
        
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <script     src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <script>
            $(document).ready(function() {
                
                var inc = 5;
                
                $("#load").attr("start",0).attr("end",inc-1); //show first items
                
                var url = 'data/news.xml';
                var title = '';
                
                $.ajax({
                    url: url,
                    dataType: "xml",
                    success: function(data) { 
                        var start = $("#load").attr("start"); // initially set to 0
                        var end = $("#load").attr("end"); // initially set to 8
                        cardLoad(data,start,end); // add Cards from 1-10   
                   },
                    error: function(){ // spit out error if unable to access feed
                        $("#container").text("Error. Trouble accessing feed.")
                    }
                });
                
                // create
                function cardLoad(data,start,end){
                    
                    var l = $(data).find('channel item').length;
                    
                    $(data).find('channel item').each(function(items,value){
                        
                        if(items >= start && items <= end){
                            
                            var title = $(this).find('title').text();
                            var desc = $(this).find('description').text();
                            var link = $(this).find('link').text();
                            var date = new Date($(this).find('pubDate').text());
                            
                            date = formatDate(date);

                            var img = $(this).find('media\\:content, content').attr('url').replace('_MC_', '_MG_');

                            var num = items+1;
                            

                            createCard(num,title,link,desc,date,img,l); // pass data to function createCard
                        } 
                    });
                }
                
                
                
                $("#load").click(function(){
                    var start = Number($("#load").attr("start"))+inc;
                    var end = Number($("#load").attr("end"))+inc;
                    $("#load").attr("start",start).attr("end",end);

                    $.ajax({
                        url: url,
                        dataType: "xml",
                        success: function(data) {
                            var l = $(data).find('channel item');
                            if( l.length <= (end+1)){
                                $("#load").hide();
                                $("#end").show();
                        }   
                            
                            cardLoad(data,start,end); 
                        },
                        error: function(){ // spit out error if unable to access feed
                            $("#container").text("Error. Trouble accessing feed.")
                        }
                    });
                    
                })
                
                // format the date 
                function formatDate(date) { 
                  
                    var monthNames = [ 
                            "January", "February", "March",
                            "April", "May", "June", "July",
                            "August", "September", "October",
                            "November", "December"
                    ];

                    var day = date.getDate(); // Day as 1-31
                    var monthIndex = date.getMonth(); // Month as 0-11
                    var year = date.getFullYear(); // Year as YYYY

                    return monthNames[monthIndex] + ' '+ day + ', ' + year;
                    
                }

                // Build out each news card to send back to the page
                function createCard(num,title,link,desc,date,img,count){
                    $("<div>",{id:"story"+num,number:num,class:"col-sm-6 col-md-4"}).appendTo(".tiles");
                    $("<div>",{class:"thumbnail"}).appendTo("#story"+num);
                    $("<img>",{src:img,alt:title}).appendTo("#story"+num+" .thumbnail");
                    $("<div>",{class:"caption"}).appendTo("#story"+num+" .thumbnail");
                    $("<h3>").text(title).appendTo("#story"+num+" .caption");
                    $("<p>",{text:num+" of "+count+" "+date,class:"byline"}).appendTo("#story"+num+" .caption");
                    $("<p>",{text:desc}).appendTo("#story"+num+" .caption");
                    $("<p>").appendTo("#story"+num+" .caption");
                    $("<a>",{href:link,class:"btn btn-primary",role:"button"}).text('Read More').appendTo("#story"+num+" .caption");  
                }
                
            });
                
        </script>
        
    </body>
    
</html>
